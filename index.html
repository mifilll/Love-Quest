<!--
Love Quest - single-file HTML game
Instructions:
1) Download the photo you uploaded and save it as: photo.jpg
   (or change the filename in the code below)
2) Download the mp3 you uploaded and save it as: music.mp3
3) Put index.html, photo.jpg and music.mp3 in the same folder and open index.html in a browser.

Controls: Arrow keys or A/D to move, Space to jump

Final message (in Russian) is embedded: "Я не знаю, как объяснить, но каждый день с тобой — мой лучший уровень ❤️"
-->

<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Love Quest</title>
  <style>
    html,body{height:100%;margin:0;background:#f2f6ff;font-family:Inter, system-ui, sans-serif}
    #gameWrap{display:flex;align-items:center;justify-content:center;height:100%}
    canvas{background:linear-gradient(#b3e5ff,#fff);border:6px solid #fff;box-shadow:0 10px 30px rgba(0,0,0,.12);border-radius:12px}
    .overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
    .finalCard{width:90%;max-width:720px;background:linear-gradient(180deg,#fff, #fff);border-radius:16px;padding:18px;box-shadow:0 20px 40px rgba(0,0,0,.25);text-align:center;transform:scale(.98);opacity:0;transition:all .4s ease;pointer-events:auto}
    .finalCard.show{opacity:1;transform:scale(1)}
    .finalPhoto{width:220px;height:220px;border-radius:14px;object-fit:cover;display:block;margin:14px auto}
    h1{margin:6px 0 8px;font-size:20px}
    p{margin:0 0 12px;color:#333}
    button.share{background:#ff6b8a;border:none;color:#fff;padding:10px 18px;border-radius:10px;font-weight:600;cursor:pointer}
    .hud{position:fixed;left:18px;top:18px;background:rgba(255,255,255,.85);padding:8px 12px;border-radius:10px;box-shadow:0 6px 14px rgba(0,0,0,.08)}
    .hint{position:fixed;right:18px;top:18px;background:rgba(255,255,255,.85);padding:8px 12px;border-radius:10px;box-shadow:0 6px 14px rgba(0,0,0,.06)}
  </style>
</head>
<body>
  <div id="gameWrap">
    <canvas id="game" width="900" height="520"></canvas>
  </div>

  <div class="hud" id="hud">Собрано: <span id="col">0</span>/5</div>
  <div class="hint">Клавиши ← →, пробел — прыжок</div>

  <div class="overlay">
    <div class="finalCard" id="final">
      <h1>Ты прошла финальный уровень!</h1>
      <img src="photo.jpg" alt="Фото" class="finalPhoto" id="finalPhoto">
      <p id="finalText">Я не знаю, как объяснить, но каждый день с тобой — мой лучший уровень ❤️</p>
      <button class="share" id="replayBtn">Играть снова</button>
    </div>
  </div>

  <audio id="music" src="music.mp3" preload="auto"></audio>

  <script>
  // Simple platformer - vanilla JS
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;

  // Player
  const player = {x:80,y:350,w:36,h:48,vx:0,vy:0,onGround:false};
  const gravity = 0.9, friction = 0.85;

  // Controls
  const keys = {};
  window.addEventListener('keydown', e=>{ keys[e.code]=true; if(e.code==='Space') e.preventDefault(); });
  window.addEventListener('keyup', e=>{ keys[e.code]=false; });

  // Platforms
  const platforms = [
    {x:0,y:460,w:900,h:60},
    {x:140,y:380,w:120,h:16},
    {x:300,y:320,w:140,h:16},
    {x:520,y:260,w:120,h:16},
    {x:700,y:200,w:160,h:16}
  ];

  // Collectibles (heart pieces)
  const pieces = [
    {x:180,y:340,collected:false},
    {x:360,y:280,collected:false},
    {x:580,y:220,collected:false},
    {x:760,y:160,collected:false},
    {x:420,y:420,collected:false}
  ];

  function drawRoundedRect(x,y,w,h,r){
    ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); ctx.fill();
  }

  function draw(){
    ctx.clearRect(0,0,W,H);

    // background clouds
    for(let i=0;i<6;i++){
      ctx.fillStyle='rgba(255,255,255,0.9)';
      drawRoundedRect(i*150+40,40+Math.sin(Date.now()/1000+i)*6,120,40,20);
    }

    // platforms
    ctx.fillStyle='#ffdede';
    for(let p of platforms){ drawRoundedRect(p.x,p.y,p.w,p.h,8); }

    // pieces
    for(let i=0;i<pieces.length;i++){
      const s = pieces[i];
      if(s.collected) continue;
      const cx = s.x, cy = s.y;
      // cartoon heart
      ctx.save(); ctx.translate(cx,cy);
      ctx.beginPath(); ctx.moveTo(0, -10); ctx.bezierCurveTo(-18,-40,-60,-6,-8,18); ctx.bezierCurveTo(10,28,28,12,28,12); ctx.bezierCurveTo(34,-6,18,-40,0,-10); ctx.closePath();
      ctx.fillStyle='#ff6b8a'; ctx.fill();
      ctx.restore();
    }

    // player (multitoned cartoon)
    // shadow
    ctx.fillStyle='rgba(0,0,0,0.12)'; ctx.beginPath(); ctx.ellipse(player.x+player.w/2, player.y+player.h+8, 26,8,0,0,Math.PI*2); ctx.fill();
    // body
    ctx.fillStyle='#fff'; drawRoundedRect(player.x,player.y,player.w,player.h,8);
    // face
    ctx.fillStyle='#ffd2a6'; ctx.beginPath(); ctx.ellipse(player.x+player.w/2, player.y+18, 14,12,0,0,Math.PI*2); ctx.fill();
    // hair
    ctx.fillStyle='#3b3b3b'; ctx.fillRect(player.x+6, player.y+4, 24,10);

    // HUD piece count handled outside
  }

  function update(){
    // horizontal
    if(keys['ArrowLeft'] || keys['KeyA']){ player.vx = Math.max(player.vx-1.2, -6); }
    if(keys['ArrowRight'] || keys['KeyD']){ player.vx = Math.min(player.vx+1.2, 6); }
    if(!keys['ArrowLeft'] && !keys['KeyA'] && !keys['ArrowRight'] && !keys['KeyD']) player.vx *= friction;

    // jump
    if((keys['Space'] || keys['ArrowUp'] || keys['KeyW']) && player.onGround){ player.vy = -15; player.onGround = false; }

    // physics
    player.vy += gravity; player.x += player.vx; player.y += player.vy;

    // world bounds
    if(player.x < 0) player.x = 0; if(player.x + player.w > W) player.x = W - player.w;
    if(player.y > H){ // fell -> reset
      resetPlayer();
    }

    // platform collisions
    player.onGround = false;
    for(let p of platforms){
      if(player.x + player.w > p.x && player.x < p.x + p.w && player.y + player.h > p.y && player.y + player.h < p.y + p.h + 30 && player.vy >=0){
        player.y = p.y - player.h; player.vy = 0; player.onGround = true;
      }
    }

    // collect pieces
    for(let s of pieces){
      if(s.collected) continue;
      const px = s.x, py = s.y;
      const dx = (player.x + player.w/2) - px;
      const dy = (player.y + player.h/2) - py;
      if(Math.sqrt(dx*dx+dy*dy) < 36){ s.collected = true; updateCount(); }
    }

    // check win
    if(pieces.every(p=>p.collected)) finish();
  }

  function resetPlayer(){ player.x=80; player.y=350; player.vx=0; player.vy=0; }

  function updateCount(){ document.getElementById('col').textContent = pieces.filter(p=>p.collected).length; }

  let finished=false;
  function finish(){ if(finished) return; finished=true;
    // show final overlay, play music
    const final = document.getElementById('final'); final.classList.add('show');
    const music = document.getElementById('music');
    music.currentTime = 0; music.play().catch(()=>{});
  }

  // replay
  document.getElementById('replayBtn').addEventListener('click', ()=>{
    // reset
    for(let p of pieces) p.collected=false; updateCount(); resetPlayer(); finished=false;
    document.getElementById('final').classList.remove('show'); document.getElementById('music').pause();
  });

  // main loop
  function loop(){ update(); draw(); requestAnimationFrame(loop); }
  updateCount(); loop();

  // small mobile support: tap to jump
  let lastTap=0; canvas.addEventListener('touchstart', (e)=>{ const now=Date.now(); if(now-lastTap<300){ if(player.onGround) player.vy=-15; } lastTap=now; });
  </script>
</body>
</html>
